@{
    ViewData["Title"] = "Creación de Fondos";
}

@section Scripts {
    <!-- jQuery (ya lo tenías) -->
    <script src="~/js/jquery-3.7.1.min.js" asp-append-version="true"></script>

    <!-- jQuery UI (para el Datepicker) -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>

    <!-- *** ¡NUEVO! *** Script de localización para español -->
    <script src="https://code.jquery.com/ui/1.13.3/i18n/datepicker-es.js"></script>

    <!-- Tus otros scripts -->
    <script src="~/js/Fondo/Fondo.js" asp-append-version="true"></script>
    <script src="~/js/datatables.min.js" asp-append-version="true"></script>

    <!-- Estilo simple para que el datepicker se parezca a Bootstrap -->
    <style>
        .ui-datepicker {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 0.9rem; /* Tamaño de letra más acorde */
            z-index: 1056 !important; /* Asegura que se muestre sobre otros elementos (como modales si los usaras) */
        }
        /* Para que el check de la tabla se vea bien */
        #tablaProveedores img {
            height: 1.2em;
        }
    </style>

    <!-- *** ¡MODIFICADO! *** Script para inicializar el Datepicker en Español y con botones -->
    <script>
        $(document).ready(function () {

            // 1. Cargar la configuración regional en español
            $.datepicker.setDefaults($.datepicker.regional['es']);

            // 2. Inicializa los datepickers
            $("#fondoFechaInicio, #fondoFechaFin").datepicker({
                dateFormat: "dd/mm/yy", // Formato que coincide con tu placeholder
                changeMonth: true,
                changeYear: true,
                showButtonPanel: true, // Muestra el panel de botones
                // 'beforeShow' se usa para modificar los botones antes de que se muestren
                beforeShow: function(input, inst) {
                    // Retrasar la modificación para asegurar que el panel de botones exista
                    setTimeout(function() {
                        let buttonPane = $(inst.dpDiv).find(".ui-datepicker-buttonpane");

                        // 1. Cambiar el texto del botón "Done" (Cerrar) a "Borrar"
                        let doneButton = buttonPane.find(".ui-datepicker-close");
                        doneButton.text("Borrar");

                        // 2. Reasignar el evento 'click' del botón "Borrar" para que limpie el campo
                        doneButton.off("click").on("click", function () {
                            // Limpiar el valor del input
                            $(input).val("");
                            // Esconder el datepicker
                            $.datepicker._hideDatepicker();
                        });

                        // 3. (Opcional) Asegurarse que el botón "Hoy" esté correcto
                        let todayButton = buttonPane.find(".ui-datepicker-current");
                        todayButton.text("Hoy");

                    }, 1);
                }
            });

            // 3. Asigna el clic del *botón* para que abra el datepicker del *input*
            $("#btnFechaInicio").on("click", function () {
                $("#fondoFechaInicio").datepicker("show");
            });

            $("#btnFechaFin").on("click", function () {
                $("#fondoFechaFin").datepicker("show");
            });
        });
    </script>
}

<!-- Encabezado compacto -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-2 pb-1 mb-2 border-bottom">
    <h1 class="h4">Fondos - Creación</h1>
</div>

<!-- Formulario compacto (g-2 y márgenes reducidos) -->
<form class="row g-2 mb-3 pb-2">
    <!-- Fila 1 -->
    <div class="col-md-2">
        <label for="fondoTipo" class="form-label fw-bold col-form-label-sm">Tipo Fondo</label>
        <!-- Este select se rellenará dinámicamente por Fondo.js -->
        <select id="fondoTipo" class="form-select form-select-sm">
            <option selected>Cargando...</option>
        </select>
    </div>
    <div class="col-md-3">
        <label for="fondoProveedor" class="form-label fw-bold col-form-label-sm">Proveedor</label>
        <div class="input-group input-group-sm">
            <input type="text" class="form-control" id="fondoProveedor" value="Industrias MABE S.A" readonly>
            <!-- *** ¡MODIFICADO! *** Se agregaron data-bs-toggle y data-bs-target -->
            <button class="btn btn-outline-secondary" type="button" id="btnBuscarProveedorModal" data-bs-toggle="modal" data-bs-target="#modalConsultaProveedor">
                <img src="~/img/ico/search.svg" alt="Buscar">
            </button>
        </div>
    </div>
    <div class="col-md-3">
        <label for="fondoDescripcion" class="form-label fw-bold col-form-label-sm">Descripción</label>
        <input type="text" class="form-control form-control-sm" id="fondoDescripcion" placeholder="Ingrese Descripción">
    </div>
    <div class="col-md-2">
        <label for="fondoFechaInicio" class="form-label fw-bold col-form-label-sm">Fecha Inicio</label>
        <div class="input-group input-group-sm">
            <input id="fondoFechaInicio" type="text" class="form-control form-control-sm" placeholder="dd/mm/aaaa">
            <!-- ID agregado al botón para el script -->
            <button class="btn btn-outline-secondary" type="button" id="btnFechaInicio">
                <img src="~/img/ico/calendar2-week.svg" alt="Calendario">
            </button>
        </div>
    </div>
    <div class="col-md-2">
        <label for="fondoFechaFin" class="form-label fw-bold col-form-label-sm">Fecha Fin</label>
        <div class="input-group input-group-sm">
            <input id="fondoFechaFin" type="text" class="form-control form-control-sm" placeholder="dd/mm/aaaa">
            <!-- ID agregado al botón para el script -->
            <button class="btn btn-outline-secondary" type="button" id="btnFechaFin">
                <img src="~/img/ico/calendar2-week.svg" alt="Calendario">
            </button>
        </div>
    </div>

    <!-- Fila 2 -->
    <div class="col-md-3">
        <label for="fondoValorTotal" class="form-label fw-bold col-form-label-sm">$ Valor Total</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoValorTotal" value="9,999,999.99">
    </div>
    <div class="col-md-3">
        <label for="fondoDisponible" class="form-label fw-bold col-form-label-sm">$ Disponible</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoDisponible" value="9,999,999.99">
    </div>
    <div class="col-md-3">
        <label for="fondoComprometido" class="form-label fw-bold col-form-label-sm">$ Comprometido</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoComprometido" value="$ 0.00" readonly>
    </div>
    <div class="col-md-3">
        <label for="fondoLiquidado" class="form-label fw-bold col-form-label-sm">$ Liquidado</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoLiquidado" value="$ 0.00" readonly>
    </div>

    <hr>

    <!-- Fila 3 - Botón (se quitó mt-2 para reducir espacio) -->
    <div class="col-12">
        <!-- *** ¡NUEVO! *** Se agregó el ID -->
        <button type="button" class="btn btn-primary" id="btnGuardarFondos">Grabar</button>
    </div>
</form>


<!-- =================================================================== -->
<!-- INICIO: MODAL CONSULTA DE PROVEEDORES -->
<!-- =================================================================== -->
<div class="modal fade" id="modalConsultaProveedor" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalConsultaProveedorLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modalConsultaProveedorLabel">Consulta de Proveedores</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-1">
                    <div class="d-flex align-items-cente mt-2">
                        <div class="p-0">
                            <!-- Texto "Seleccione un Proveedor" como en la imagen -->
                            <label class="form-control text-dark border-0 bg-transparent p-0">Seleccione un Proveedor</label>
                        </div>
                        <div class="p-0 flex-grow-1 text-center"></div>
                        <div class="p-0">
                            <input type="text" class="form-control form-control-sm" placeholder="Buscar...">
                        </div>
                    </div>
                </div>

                <div class="row mb-1">
                    <div class="col">
                        <div class="table-responsive small border" style="height: 300px">
                            <!-- Asegúrate de que este ID 'tablaProveedores' exista para el JS -->
                            <table id="tablaProveedores" class="table table-hover table-bordered table-sm w-100">
                                <thead class="sticky-top table-success text-white text-nowrap">
                                    <tr>
                                        <!-- *** ¡MODIFICADO! *** Se agregó la columna 'Seleccionar' -->
                                        <th scope="col" class="table-sticky-col text-center">Seleccionar</th>
                                        <th scope="col">Codigo</th>
                                        <th scope="col">Ruc</th>
                                        <th scope="col">Nombre Proveedor</th>
                                        <th scope="col">Contacto</th>
                                        <th scope="col">Mail</th>
                                        <th scope="col">Teléfono</th>
                                    </tr>
                                </thead>
                                <!-- *** ¡MODIFICADO! *** Se agregaron los datos quemados de la imagen -->
                                <tbody class="text-nowrap">
                                    <tr>
                                        <td class="align-middle text-center"><img src="~/img/ico/check-lg.svg" alt="Seleccionado" fill="text-success"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0992864435001</td>
                                        <td class="align-middle">Industrias MABE S.A</td>
                                        <td class="align-middle">Ali Macias</td>
                                        <td class="align-middle">amacias@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04218478</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                    <tr>
                                        <td class="align-middle text-center"></td>
                                        <td class="align-middle">102030</td>
                                        <td class="align-middle">0999999999001</td>
                                        <td class="align-middle">Proveedor XXXXXXXXXX</td>
                                        <td class="align-middle">Contacto XXXXXX</td>
                                        <td class="align-middle">xxxxxxxxxx@mabe.com.ec</td>
                                        <td class="align-middle">(593) 04299999</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row mb-2">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item active"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button typeT="button" class="btn btn-primary" id="btnAceptarProveedor">Aceptar</button>
            </div>
        </div>
    </div>
</div>
<!-- Autor: JEAN FRANCOIS CALDERON VEAS | Empresa: BMTECSA | Proyecto: SOFTWARE APL -->