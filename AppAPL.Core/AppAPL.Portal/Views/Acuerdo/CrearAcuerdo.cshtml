@{
    ViewData["Title"] = "Creación de Acuerdo";
    var usuarioActual = ViewBag.UsuarioActual as string;
}

@section Scripts {
    <script>
        window.usuarioActual = '@usuarioActual';
    </script>

    <!-- jQuery -->
    <script src="~/js/jquery-3.7.1.min.js" asp-append-version="true"></script>

    <!-- jQuery UI (Datepicker) -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <!-- OJO: aquí era .s, debe ser .js -->
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>

    <!-- Localización Datepicker ES -->
    <script src="https://code.jquery.com/ui/1.13.3/i18n/datepicker-es.js"></script>

    <!-- DataTables (si lo usas) -->
    <script src="~/js/datatables.min.js" asp-append-version="true"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Script principal -->
    <script src="~/js/Acuerdo/CrearAcuerdo.js" asp-append-version="true"></script>

    <style>
        .ui-datepicker {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 0.9rem;
            z-index: 1056 !important;
        }

        .detalle-header {
            background-color: #343a40;
            color: white;
            padding: 8px 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 15px;
            border-radius: 4px;
        }

        .tabla-items-header th {
            background-color: #a4c995;
            color: #343a40;
            font-weight: bold;
            vertical-align: middle;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .tabla-items-body input[type="text"] {
            text-align: right;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            height: 28px;
            border: 1px solid #ced4da;
            border-radius: 0.2rem;
        }
    </style>
}

<!-- Encabezado -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-2 pb-1 mb-2 border-bottom">
    <h1 class="h4">Acuerdo - Creación</h1>
</div>

<!-- Selector tipo acuerdo -->
<div class="col-md-13">
    <label for="acuerdoTipo" class="form-label fw-bold col-form-label-sm">Tipo de Acuerdo</label>
    <select id="acuerdoTipo" class="form-select form-select-sm">
        <option value="General" selected>General</option>
        <option value="Items">Artículo</option>
    </select>
</div>

<hr />

<!-- ========================================================= -->
<!-- FORM GENERAL -->
<!-- ========================================================= -->
<form id="formGeneral" class="row g-1 mb-1 pb-1">

    <div class="col-md-3">
        <label class="form-label fw-bold col-form-label-sm">Proveedor</label>
        <div class="input-group input-group-sm">
            <input type="text" class="form-control" id="fondoProveedorGeneral" value="Seleccione..." readonly>
            <button class="btn btn-outline-secondary" type="button"
                    data-bs-toggle="modal" data-bs-target="#modalConsultaProveedor">
                <img src="~/img/ico/search.svg" alt="Buscar">
            </button>
        </div>
        <input type="hidden" id="fondoProveedorIdGeneral">
    </div>

    <div class="col-md-2">
        <label for="fondoTipoGeneral" class="form-label fw-bold col-form-label-sm">Motivo</label>
        <select id="fondoTipoGeneral" class="form-select form-select-sm">
            <option selected>Cargando...</option>
        </select>
    </div>

    <div class="col-md-3">
        <label for="fondoDescripcionGeneral" class="form-label fw-bold col-form-label-sm">Descripción</label>
        <input type="text" class="form-control form-control-sm" id="fondoDescripcionGeneral" placeholder="Ingrese Descripción">
    </div>

    <div class="col-md-2">
        <label for="fondoFechaInicioGeneral" class="form-label fw-bold col-form-label-sm">Fecha Inicio</label>
        <div class="input-group input-group-sm">
            <input id="fondoFechaInicioGeneral" type="text" class="form-control form-control-sm" placeholder="dd/mm/aaaa">
            <button class="btn btn-outline-secondary" type="button" id="btnFechaInicioGeneral">
                <img src="~/img/ico/calendar2-week.svg" alt="Calendario">
            </button>
        </div>
    </div>

    <div class="col-md-2">
        <label for="fondoFechaFinGeneral" class="form-label fw-bold col-form-label-sm">Fecha Fin</label>
        <div class="input-group input-group-sm">
            <input id="fondoFechaFinGeneral" type="text" class="form-control form-control-sm" placeholder="dd/mm/aaaa">
            <button class="btn btn-outline-secondary" type="button" id="btnFechaFinGeneral">
                <img src="~/img/ico/calendar2-week.svg" alt="Calendario">
            </button>
        </div>
    </div>

    <div class="col-md-3 mt-0">
        <label for="fondoValorTotalGeneral" class="form-label fw-bold col-form-label-sm">$ Valor Total</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoValorTotalGeneral" placeholder="$ 0,00">
    </div>

    <div class="col-md-3 mt-0">
        <label for="fondoDisponibleGeneral" class="form-label fw-bold col-form-label-sm">$ Disponible</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoDisponibleGeneral" placeholder="$ 0,00" disabled>
    </div>

    <div class="col-md-3 mt-0">
        <label class="form-label fw-bold col-form-label-sm">$ Comprometido</label>
        <input type="text" class="form-control form-control-sm text-end" value="$ 0,00" disabled>
    </div>

    <div class="col-md-3 mt-0">
        <label class="form-label fw-bold col-form-label-sm">$ Liquidado</label>
        <input type="text" class="form-control form-control-sm text-end" value="$ 0,00" disabled>
    </div>

    <hr class="mt-1 mb-1" />

    <div class="col-12">
        <button type="button" class="btn btn-primary" id="btnGuardarAcuerdoGeneral">Grabar</button>
    </div>
</form>

<!-- ========================================================= -->
<!-- MODAL PROVEEDORES -->
<!-- ========================================================= -->
<div class="modal fade" id="modalConsultaProveedor" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="modalConsultaProveedorLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xxl">
        <div class="modal-content" style="height: 90vh; max-height: 90vh;">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modalConsultaProveedorLabel">Consulta de Proveedores</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body d-flex flex-column" style="height: calc(90vh - 120px);">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="fw-semibold">Seleccione un Proveedor</span>
                    <input type="text" class="form-control form-control-sm" placeholder="Buscar..." style="width: 250px;">
                </div>

                <div class="table-responsive flex-grow-1 border rounded" style="overflow-y: auto;">
                    <table id="tablaProveedores" class="table table-hover table-sm table-bordered mb-0">
                        <thead class="table-success sticky-top">
                            <tr class="text-nowrap">
                                <th class="text-center align-middle" style="min-width: 70px;">Sel.</th>
                                <th class="align-middle" style="min-width: 90px;">IDFondo</th>
                                <th class="align-middle" style="min-width: 220px;">Descripción</th>
                                <th class="align-middle" style="min-width: 140px;">RUC</th>
                                <th class="align-middle" style="min-width: 220px;">Proveedor</th>
                                <th class="align-middle" style="min-width: 130px;">Tipo Fondo</th>
                                <th class="align-middle text-end" style="min-width: 120px;">$ Fondo</th>
                                <th class="align-middle" style="min-width: 120px;">Fecha Inicio</th>
                                <th class="align-middle" style="min-width: 120px;">Fecha Fin</th>
                                <th class="align-middle text-end" style="min-width: 130px;">$ Disponible</th>
                                <th class="align-middle text-end" style="min-width: 150px;">$ Comprometido</th>
                                <th class="align-middle text-end" style="min-width: 130px;">$ Liquidado</th>
                                <th class="align-middle" style="min-width: 110px;">Estado</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                </div>

                <nav aria-label="Navegación de páginas" class="mt-2">
                    <ul class="pagination pagination-sm justify-content-center mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" aria-label="Anterior">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#" aria-label="Siguiente">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btnAceptarProveedor">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- ========================================================= -->
<!-- FORM ITEMS -->
<!-- ========================================================= -->
<form id="formItems" class="row g-1 mb-1 pb-1" style="display:none;">

    <div class="col-md-3">
        <label for="fondoTipoItems" class="form-label fw-bold col-form-label-sm">Motivo</label>
        <select id="fondoTipoItems" class="form-select form-select-sm">
            <option selected>Cargando...</option>
        </select>
    </div>

    <div class="col-md-3">
        <label for="fondoDescripcionItems" class="form-label fw-bold col-form-label-sm">Descripción</label>
        <input type="text" class="form-control form-control-sm" id="fondoDescripcionItems" placeholder="Ingrese Descripción">
    </div>

    <div class="col-md-3">
        <label for="fondoFechaInicioItems" class="form-label fw-bold col-form-label-sm">Fecha Inicio</label>
        <div class="input-group input-group-sm">
            <input id="fondoFechaInicioItems" type="text" class="form-control form-control-sm" placeholder="dd/mm/aaaa">
            <button class="btn btn-outline-secondary" type="button" id="btnFechaInicioItems">
                <img src="~/img/ico/calendar2-week.svg" alt="Calendario">
            </button>
        </div>
    </div>

    <div class="col-md-3">
        <label for="fondoFechaFinItems" class="form-label fw-bold col-form-label-sm">Fecha Fin</label>
        <div class="input-group input-group-sm">
            <input id="fondoFechaFinItems" type="text" class="form-control form-control-sm" placeholder="dd/mm/aaaa">
            <button class="btn btn-outline-secondary" type="button" id="btnFechaFinItems">
                <img src="~/img/ico/calendar2-week.svg" alt="Calendario">
            </button>
        </div>
    </div>

    <div class="col-md-3">
        <label class="form-label fw-bold col-form-label-sm">Proveedor</label>
        <div class="input-group input-group-sm">
            <input type="text" class="form-control" id="fondoProveedorItems" value="Seleccione..." readonly>
            <button class="btn btn-outline-secondary" type="button"
                    data-bs-toggle="modal" data-bs-target="#modalConsultaProveedor">
                <img src="~/img/ico/search.svg" alt="Buscar">
            </button>
        </div>
        <input type="hidden" id="fondoProveedorIdItems">
    </div>

    <div class="col-md-3 mt-0">
        <label class="form-label fw-bold col-form-label-sm">$ Proveedor - Total</label>
        <input type="text" class="form-control form-control-sm text-end" id="fondoValorTotalItems" placeholder="$ 0,00" disabled>
    </div>

    <div class="col-12 mt-3">
        <div class="detalle-header">Detalle de los Artículos</div>

        <div class="d-flex align-items-center gap-3 pt-2 pb-1">
            <a href="#" class="text-decoration-none text-primary fw-semibold d-flex align-items-center gap-1" id="btnAddItem">
                <i class="fa-solid fa-plus"></i> Añadir Item
            </a>
            <a href="#" class="text-decoration-none text-warning fw-semibold d-flex align-items-center gap-1" id="btnModifyItem">
                <i class="fa-regular fa-pen-to-square"></i> Modificar
            </a>
            <a href="#" class="text-decoration-none text-danger fw-semibold d-flex align-items-center gap-1" id="btnDeleteItem">
                <i class="fa-regular fa-trash-can"></i> Eliminar
            </a>
        </div>

        <div class="table-responsive border rounded" style="max-height: 40vh; overflow-y: auto;">
            <table id="tablaItems" class="table table-sm table-bordered mb-0">
                <thead class="tabla-items-header sticky-top">
                    <tr>
                        <th style="min-width: 50px;"></th>
                        <th style="min-width: 250px;">Item</th>
                        <th style="min-width: 120px;">Costo</th>
                        <th style="min-width: 100px;">Unidades Límite</th>
                        <th style="min-width: 130px;">Precio - Contado</th>
                        <th style="min-width: 130px;">Precio - TC</th>
                        <th style="min-width: 130px;">Precio - Crédito</th>
                        <th style="min-width: 150px;">Aporte por Unidad - Proveedor</th>
                        <th style="min-width: 130px;">Comprometido Proveedor</th>
                        <th style="min-width: 100px;">Margen Contado</th>
                        <th style="min-width: 100px;">Margen TC</th>
                        <th style="min-width: 100px;">Margen Crédito</th>
                    </tr>
                </thead>
                <tbody id="tablaItemsBody" class="tabla-items-body">
                    <!-- Se llena por JS -->
                </tbody>
            </table>
        </div>
    </div>

    <hr class="mt-3 mb-1" />

    <div class="col-12">
        <button type="button" class="btn btn-primary" id="btnGuardarAcuerdoItems">Grabar</button>
    </div>
</form>

<!-- Autor: JEAN FRANCOIS CALDERON VEAS | Empresa: BMTECSA | Proyecto: SOFTWARE APL -->
